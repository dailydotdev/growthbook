{"version":3,"file":"esm.js","sources":["../../src/util.ts","../../src/mongrule.ts","../../src/GrowthBook.ts"],"sourcesContent":["import { UrlTarget, UrlTargetType, VariationRange } from \"./types/growthbook\";\n\nfunction hashFnv32a(str: string): number {\n  let hval = 0x811c9dc5;\n  const l = str.length;\n\n  for (let i = 0; i < l; i++) {\n    hval ^= str.charCodeAt(i);\n    hval +=\n      (hval << 1) + (hval << 4) + (hval << 7) + (hval << 8) + (hval << 24);\n  }\n  return hval >>> 0;\n}\n\nexport function hash(\n  seed: string,\n  value: string,\n  version: number\n): number | null {\n  // New unbiased hashing algorithm\n  if (version === 2) {\n    return (hashFnv32a(hashFnv32a(seed + value) + \"\") % 10000) / 10000;\n  }\n  // Original biased hashing algorithm (keep for backwards compatibility)\n  if (version === 1) {\n    return (hashFnv32a(value + seed) % 1000) / 1000;\n  }\n\n  // Unknown hash version\n  return null;\n}\n\nexport function getEqualWeights(n: number): number[] {\n  if (n <= 0) return [];\n  return new Array(n).fill(1 / n);\n}\n\nexport function inRange(n: number, range: VariationRange): boolean {\n  return n >= range[0] && n < range[1];\n}\n\nexport function inNamespace(\n  hashValue: string,\n  namespace: [string, number, number]\n): boolean {\n  const n = hash(\"__\" + namespace[0], hashValue, 1);\n  if (n === null) return false;\n  return n >= namespace[1] && n < namespace[2];\n}\n\nexport function chooseVariation(n: number, ranges: VariationRange[]): number {\n  for (let i = 0; i < ranges.length; i++) {\n    if (inRange(n, ranges[i])) {\n      return i;\n    }\n  }\n  return -1;\n}\n\nexport function getUrlRegExp(regexString: string): RegExp | undefined {\n  try {\n    const escaped = regexString.replace(/([^\\\\])\\//g, \"$1\\\\/\");\n    return new RegExp(escaped);\n  } catch (e) {\n    console.error(e);\n    return undefined;\n  }\n}\n\nexport function isURLTargeted(url: string, targets: UrlTarget[]) {\n  if (!targets.length) return false;\n  let hasIncludeRules = false;\n  let isIncluded = false;\n\n  for (let i = 0; i < targets.length; i++) {\n    const match = _evalURLTarget(url, targets[i].type, targets[i].pattern);\n    if (targets[i].include === false) {\n      if (match) return false;\n    } else {\n      hasIncludeRules = true;\n      if (match) isIncluded = true;\n    }\n  }\n\n  return isIncluded || !hasIncludeRules;\n}\n\nfunction _evalSimpleUrlPart(\n  actual: string,\n  pattern: string,\n  isPath: boolean\n): boolean {\n  try {\n    // Escape special regex characters and change wildcard `_____` to `.*`\n    let escaped = pattern\n      .replace(/[*.+?^${}()|[\\]\\\\]/g, \"\\\\$&\")\n      .replace(/_____/g, \".*\");\n\n    if (isPath) {\n      // When matching pathname, make leading/trailing slashes optional\n      escaped = \"\\\\/?\" + escaped.replace(/(^\\/|\\/$)/g, \"\") + \"\\\\/?\";\n    }\n\n    const regex = new RegExp(\"^\" + escaped + \"$\", \"i\");\n    return regex.test(actual);\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _evalSimpleUrlTarget(actual: URL, pattern: string) {\n  try {\n    // If a protocol is missing, but a host is specified, add `https://` to the front\n    // Use \"_____\" as the wildcard since `*` is not a valid hostname in some browsers\n    const expected = new URL(\n      pattern.replace(/^([^:/?]*)\\./i, \"https://$1.\").replace(/\\*/g, \"_____\"),\n      \"https://_____\"\n    );\n\n    // Compare each part of the URL separately\n    const comps: Array<[string, string, boolean]> = [\n      [actual.host, expected.host, false],\n      [actual.pathname, expected.pathname, true],\n    ];\n    // We only want to compare hashes if it's explicitly being targeted\n    if (expected.hash) {\n      comps.push([actual.hash, expected.hash, false]);\n    }\n\n    expected.searchParams.forEach((v, k) => {\n      comps.push([actual.searchParams.get(k) || \"\", v, false]);\n    });\n\n    // If any comparisons fail, the whole thing fails\n    return !comps.some(\n      (data) => !_evalSimpleUrlPart(data[0], data[1], data[2])\n    );\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _evalURLTarget(\n  url: string,\n  type: UrlTargetType,\n  pattern: string\n): boolean {\n  try {\n    const parsed = new URL(url, \"https://_\");\n\n    if (type === \"regex\") {\n      const regex = getUrlRegExp(pattern);\n      if (!regex) return false;\n      return (\n        regex.test(parsed.href) ||\n        regex.test(parsed.href.substring(parsed.origin.length))\n      );\n    } else if (type === \"simple\") {\n      return _evalSimpleUrlTarget(parsed, pattern);\n    }\n\n    return false;\n  } catch (e) {\n    return false;\n  }\n}\n\nexport function getBucketRanges(\n  numVariations: number,\n  coverage: number | undefined,\n  weights?: number[]\n): VariationRange[] {\n  coverage = coverage === undefined ? 1 : coverage;\n\n  // Make sure coverage is within bounds\n  if (coverage < 0) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\"Experiment.coverage must be greater than or equal to 0\");\n    }\n    coverage = 0;\n  } else if (coverage > 1) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\"Experiment.coverage must be less than or equal to 1\");\n    }\n    coverage = 1;\n  }\n\n  // Default to equal weights if missing or invalid\n  const equal = getEqualWeights(numVariations);\n  weights = weights || equal;\n  if (weights.length !== numVariations) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\n        \"Experiment.weights array must be the same length as Experiment.variations\"\n      );\n    }\n    weights = equal;\n  }\n\n  // If weights don't add up to 1 (or close to it), default to equal weights\n  const totalWeight = weights.reduce((w, sum) => sum + w, 0);\n  if (totalWeight < 0.99 || totalWeight > 1.01) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\"Experiment.weights must add up to 1\");\n    }\n    weights = equal;\n  }\n\n  // Covert weights to ranges\n  let cumulative = 0;\n  return weights.map((w) => {\n    const start = cumulative;\n    cumulative += w;\n    return [start, start + (coverage as number) * w];\n  }) as VariationRange[];\n}\n\nexport function getQueryStringOverride(\n  id: string,\n  url: string,\n  numVariations: number\n) {\n  if (!url) {\n    return null;\n  }\n\n  const search = url.split(\"?\")[1];\n  if (!search) {\n    return null;\n  }\n\n  const match = search\n    .replace(/#.*/, \"\") // Get rid of anchor\n    .split(\"&\") // Split into key/value pairs\n    .map((kv) => kv.split(\"=\", 2))\n    .filter(([k]) => k === id) // Look for key that matches the experiment id\n    .map(([, v]) => parseInt(v)); // Parse the value into an integer\n\n  if (match.length > 0 && match[0] >= 0 && match[0] < numVariations)\n    return match[0];\n\n  return null;\n}\n\nexport function isIncluded(include: () => boolean) {\n  try {\n    return include();\n  } catch (e) {\n    console.error(e);\n    return false;\n  }\n}\n\nconst base64ToBuf = (b: string) =>\n  Uint8Array.from(atob(b), (c) => c.charCodeAt(0));\n\nexport async function decrypt(\n  encryptedString: string,\n  decryptionKey?: string,\n  subtle?: SubtleCrypto\n): Promise<string> {\n  decryptionKey = decryptionKey || \"\";\n  subtle = subtle || (globalThis.crypto && globalThis.crypto.subtle);\n  if (!subtle) {\n    throw new Error(\"No SubtleCrypto implementation found\");\n  }\n  try {\n    const key = await subtle.importKey(\n      \"raw\",\n      base64ToBuf(decryptionKey),\n      { name: \"AES-CBC\", length: 128 },\n      true,\n      [\"encrypt\", \"decrypt\"]\n    );\n    const [iv, cipherText] = encryptedString.split(\".\");\n    const plainTextBuffer = await subtle.decrypt(\n      { name: \"AES-CBC\", iv: base64ToBuf(iv) },\n      key,\n      base64ToBuf(cipherText)\n    );\n\n    return new TextDecoder().decode(plainTextBuffer);\n  } catch (e) {\n    throw new Error(\"Failed to decrypt\");\n  }\n}\n\nexport function paddedVersionString(input: string): string {\n  // Remove build info and leading `v` if any\n  // Split version into parts (both core version numbers and pre-release tags)\n  // \"v1.2.3-rc.1+build123\" -> [\"1\",\"2\",\"3\",\"rc\",\"1\"]\n  const parts = input.replace(/(^v|\\+.*$)/g, \"\").split(/[-.]/);\n\n  // If it's SemVer without a pre-release, add `~` to the end\n  // [\"1\",\"0\",\"0\"] -> [\"1\",\"0\",\"0\",\"~\"]\n  // \"~\" is the largest ASCII character, so this will make \"1.0.0\" greater than \"1.0.0-beta\" for example\n  if (parts.length === 3) {\n    parts.push(\"~\");\n  }\n\n  // Left pad each numeric part with spaces so string comparisons will work (\"9\">\"10\", but \" 9\"<\"10\")\n  // Then, join back together into a single string\n  return parts\n    .map((v) => (v.match(/^[0-9]+$/) ? v.padStart(5, \" \") : v))\n    .join(\"-\");\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\n\nimport {\n  ConditionInterface,\n  TestedObj,\n  ConditionValue,\n  Operator,\n  OperatorConditionValue,\n  VarType,\n} from \"./types/mongrule\";\nimport { paddedVersionString } from \"./util\";\n\nconst _regexCache: { [key: string]: RegExp } = {};\n\n// The top-level condition evaluation function\nexport function evalCondition(\n  obj: TestedObj,\n  condition: ConditionInterface\n): boolean {\n  // Recursive condition\n  if (\"$or\" in condition) {\n    return evalOr(obj, condition[\"$or\"] as ConditionInterface[]);\n  }\n  if (\"$nor\" in condition) {\n    return !evalOr(obj, condition[\"$nor\"] as ConditionInterface[]);\n  }\n  if (\"$and\" in condition) {\n    return evalAnd(obj, condition[\"$and\"] as ConditionInterface[]);\n  }\n  if (\"$not\" in condition) {\n    return !evalCondition(obj, condition[\"$not\"] as ConditionInterface);\n  }\n\n  // Condition is an object, keys are object paths, values are the condition for that path\n  for (const [k, v] of Object.entries(condition)) {\n    if (!evalConditionValue(v, getPath(obj, k))) return false;\n  }\n  return true;\n}\n\n// Return value at dot-separated path of an object\nfunction getPath(obj: TestedObj, path: string) {\n  const parts = path.split(\".\");\n  let current: any = obj;\n  for (let i = 0; i < parts.length; i++) {\n    if (current && typeof current === \"object\" && parts[i] in current) {\n      current = current[parts[i]];\n    } else {\n      return null;\n    }\n  }\n  return current;\n}\n\n// Transform a regex string into a real RegExp object\nfunction getRegex(regex: string): RegExp {\n  if (!_regexCache[regex]) {\n    _regexCache[regex] = new RegExp(regex.replace(/([^\\\\])\\//g, \"$1\\\\/\"));\n  }\n  return _regexCache[regex];\n}\n\n// Evaluate a single value against a condition\nfunction evalConditionValue(condition: ConditionValue, value: any) {\n  // Simple equality comparisons\n  if (typeof condition === \"string\") {\n    return value + \"\" === condition;\n  }\n  if (typeof condition === \"number\") {\n    return value * 1 === condition;\n  }\n  if (typeof condition === \"boolean\") {\n    return !!value === condition;\n  }\n\n  if (condition === null) {\n    return value === null;\n  }\n\n  if (Array.isArray(condition) || !isOperatorObject(condition)) {\n    return JSON.stringify(value) === JSON.stringify(condition);\n  }\n\n  // This is a special operator condition and we should evaluate each one separately\n  for (const op in condition) {\n    if (\n      !evalOperatorCondition(\n        op as Operator,\n        value,\n        condition[op as keyof OperatorConditionValue]\n      )\n    ) {\n      return false;\n    }\n  }\n  return true;\n}\n\n// If the object has only keys that start with '$'\nfunction isOperatorObject(obj: any): boolean {\n  const keys = Object.keys(obj);\n  return (\n    keys.length > 0 && keys.filter((k) => k[0] === \"$\").length === keys.length\n  );\n}\n\n// Return the data type of a value\nfunction getType(v: any): VarType | \"unknown\" {\n  if (v === null) return \"null\";\n  if (Array.isArray(v)) return \"array\";\n  const t = typeof v;\n  if ([\"string\", \"number\", \"boolean\", \"object\", \"undefined\"].includes(t)) {\n    return t as VarType;\n  }\n  return \"unknown\";\n}\n\n// At least one element of actual must match the expected condition/value\nfunction elemMatch(actual: any, expected: any) {\n  if (!Array.isArray(actual)) return false;\n  const check = isOperatorObject(expected)\n    ? (v: any) => evalConditionValue(expected, v)\n    : (v: any) => evalCondition(v, expected);\n  for (let i = 0; i < actual.length; i++) {\n    if (actual[i] && check(actual[i])) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction isIn(actual: any, expected: Array<any>): boolean {\n  // Do an intersection is attribute is an array\n  if (Array.isArray(actual)) {\n    return actual.some((el) => expected.includes(el));\n  }\n  return expected.includes(actual);\n}\n\n// Evaluate a single operator condition\nfunction evalOperatorCondition(\n  operator: Operator,\n  actual: any,\n  expected: any\n): boolean {\n  switch (operator) {\n    case \"$veq\":\n      return paddedVersionString(actual) === paddedVersionString(expected);\n    case \"$vne\":\n      return paddedVersionString(actual) !== paddedVersionString(expected);\n    case \"$vgt\":\n      return paddedVersionString(actual) > paddedVersionString(expected);\n    case \"$vgte\":\n      return paddedVersionString(actual) >= paddedVersionString(expected);\n    case \"$vlt\":\n      return paddedVersionString(actual) < paddedVersionString(expected);\n    case \"$vlte\":\n      return paddedVersionString(actual) <= paddedVersionString(expected);\n    case \"$eq\":\n      return actual === expected;\n    case \"$ne\":\n      return actual !== expected;\n    case \"$lt\":\n      return actual < expected;\n    case \"$lte\":\n      return actual <= expected;\n    case \"$gt\":\n      return actual > expected;\n    case \"$gte\":\n      return actual >= expected;\n    case \"$exists\":\n      return expected ? actual !== null : actual === null;\n    case \"$in\":\n      if (!Array.isArray(expected)) return false;\n      return isIn(actual, expected);\n    case \"$nin\":\n      if (!Array.isArray(expected)) return false;\n      return !isIn(actual, expected);\n    case \"$not\":\n      return !evalConditionValue(expected, actual);\n    case \"$size\":\n      if (!Array.isArray(actual)) return false;\n      return evalConditionValue(expected, actual.length);\n    case \"$elemMatch\":\n      return elemMatch(actual, expected);\n    case \"$all\":\n      if (!Array.isArray(actual)) return false;\n      for (let i = 0; i < expected.length; i++) {\n        let passed = false;\n        for (let j = 0; j < actual.length; j++) {\n          if (evalConditionValue(expected[i], actual[j])) {\n            passed = true;\n            break;\n          }\n        }\n        if (!passed) return false;\n      }\n      return true;\n    case \"$regex\":\n      try {\n        return getRegex(expected).test(actual);\n      } catch (e) {\n        return false;\n      }\n    case \"$type\":\n      return getType(actual) === expected;\n    default:\n      console.error(\"Unknown operator: \" + operator);\n      return false;\n  }\n}\n\n// Recursive $or rule\nfunction evalOr(obj: TestedObj, conditions: ConditionInterface[]): boolean {\n  if (!conditions.length) return true;\n  for (let i = 0; i < conditions.length; i++) {\n    if (evalCondition(obj, conditions[i])) {\n      return true;\n    }\n  }\n  return false;\n}\n\n// Recursive $and rule\nfunction evalAnd(obj: TestedObj, conditions: ConditionInterface[]): boolean {\n  for (let i = 0; i < conditions.length; i++) {\n    if (!evalCondition(obj, conditions[i])) {\n      return false;\n    }\n  }\n  return true;\n}\n","import type {\n  Context,\n  Experiment,\n  FeatureResult,\n  Result,\n  SubscriptionFunction,\n  FeatureDefinition,\n  FeatureResultSource,\n  Attributes,\n  WidenPrimitives,\n  VariationMeta,\n  Filter,\n  VariationRange,\n} from \"./types/growthbook\";\nimport type { ConditionInterface } from \"./types/mongrule\";\nimport {\n  getUrlRegExp,\n  isIncluded,\n  getBucketRanges,\n  hash,\n  chooseVariation,\n  getQueryStringOverride,\n  inNamespace,\n  inRange,\n  isURLTargeted,\n} from \"./util\";\nimport { evalCondition } from \"./mongrule\";\n\nconst isBrowser =\n  typeof window !== \"undefined\" && typeof document !== \"undefined\";\n\nexport class GrowthBook<\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  AppFeatures extends Record<string, any> = Record<string, any>\n> {\n  // context is technically private, but some tools depend on it so we can't mangle the name\n  // _ctx below is a clone of this property that we use internally\n  private context: Context;\n  public debug: boolean;\n  public ready: boolean;\n\n  // Properties and methods that start with \"_\" are mangled by Terser (saves ~150 bytes)\n  private _ctx: Context;\n  private _renderer: null | (() => void);\n  private _trackedExperiments: Set<unknown>;\n  private _trackedFeatures: Record<string, string>;\n  private _subscriptions: Set<SubscriptionFunction>;\n  private _assigned: Map<\n    string,\n    {\n      // eslint-disable-next-line\n      experiment: Experiment<any>;\n      // eslint-disable-next-line\n      result: Result<any>;\n    }\n  >;\n  // eslint-disable-next-line\n  private _forcedFeatureValues: Map<string, any>;\n  private _attributeOverrides: Attributes;\n  private _activeAutoExperiments: Map<\n    string,\n    { valueHash: string; undo: () => void }\n  >;\n\n  constructor(context?: Context) {\n    context = context || {};\n    // These properties are all initialized in the constructor instead of above\n    // This saves ~80 bytes in the final output\n    this._ctx = this.context = context;\n    this._renderer = null;\n    this._trackedExperiments = new Set();\n    this._trackedFeatures = {};\n    this.debug = false;\n    this._subscriptions = new Set();\n    this.ready = false;\n    this._assigned = new Map();\n    this._forcedFeatureValues = new Map();\n    this._attributeOverrides = {};\n    this._activeAutoExperiments = new Map();\n\n    if (context.features) {\n      this.ready = true;\n    }\n\n    if (isBrowser && context.enableDevMode) {\n      window._growthbook = this;\n      document.dispatchEvent(new Event(\"gbloaded\"));\n    }\n\n    if (context.experiments) {\n      this.ready = true;\n    }\n  }\n\n  private _render() {\n    if (this._renderer) {\n      this._renderer();\n    }\n  }\n\n  public setFeatures(features: Record<string, FeatureDefinition>) {\n    this._ctx.features = features;\n    this.ready = true;\n    this._render();\n  }\n\n  public setAttributes(attributes: Attributes) {\n    this._ctx.attributes = attributes;\n    this._render();\n  }\n\n  public setAttributeOverrides(overrides: Attributes) {\n    this._attributeOverrides = overrides;\n    this._render();\n  }\n  public setForcedVariations(vars: Record<string, number>) {\n    this._ctx.forcedVariations = vars || {};\n    this._render();\n  }\n  // eslint-disable-next-line\n  public setForcedFeatures(map: Map<string, any>) {\n    this._forcedFeatureValues = map;\n    this._render();\n  }\n\n  public setURL(url: string) {\n    this._ctx.url = url;\n  }\n\n  public getAttributes() {\n    return { ...this._ctx.attributes, ...this._attributeOverrides };\n  }\n\n  public getFeatures() {\n    return this._ctx.features || {};\n  }\n\n  public getExperiments() {\n    return this._ctx.experiments || [];\n  }\n\n  public subscribe(cb: SubscriptionFunction): () => void {\n    this._subscriptions.add(cb);\n\n    return () => {\n      this._subscriptions.delete(cb);\n    };\n  }\n\n  public getAllResults() {\n    return new Map(this._assigned);\n  }\n\n  public destroy() {\n    // Release references to save memory\n    this._subscriptions.clear();\n    this._assigned.clear();\n    this._trackedExperiments.clear();\n    this._trackedFeatures = {};\n\n    if (isBrowser && window._growthbook === this) {\n      delete window._growthbook;\n    }\n\n    // Undo any active auto experiments\n    this._activeAutoExperiments.forEach((exp) => {\n      exp.undo();\n    });\n    this._activeAutoExperiments.clear();\n  }\n\n  public setRenderer(renderer: () => void) {\n    this._renderer = renderer;\n  }\n\n  public forceVariation(key: string, variation: number) {\n    this._ctx.forcedVariations = this._ctx.forcedVariations || {};\n    this._ctx.forcedVariations[key] = variation;\n    this._render();\n  }\n\n  public run<T>(experiment: Experiment<T>): Result<T> {\n    const result = this._run(experiment, null);\n    this._fireSubscriptions(experiment, result);\n    return result;\n  }\n\n  private _fireSubscriptions<T>(experiment: Experiment<T>, result: Result<T>) {\n    const key = experiment.key;\n\n    // If assigned variation has changed, fire subscriptions\n    const prev = this._assigned.get(key);\n    // TODO: what if the experiment definition has changed?\n    if (\n      !prev ||\n      prev.result.inExperiment !== result.inExperiment ||\n      prev.result.variationId !== result.variationId\n    ) {\n      this._assigned.set(key, { experiment, result });\n      this._subscriptions.forEach((cb) => {\n        try {\n          cb(experiment, result);\n        } catch (e) {\n          console.error(e);\n        }\n      });\n    }\n  }\n\n  private _trackFeatureUsage(key: string, res: FeatureResult): void {\n    // Don't track feature usage that was forced via an override\n    if (res.source === \"override\") return;\n\n    // Only track a feature once, unless the assigned value changed\n    const stringifiedValue = JSON.stringify(res.value);\n    if (this._trackedFeatures[key] === stringifiedValue) return;\n    this._trackedFeatures[key] = stringifiedValue;\n\n    // Fire user-supplied callback\n    if (this._ctx.onFeatureUsage) {\n      try {\n        this._ctx.onFeatureUsage(key, res);\n      } catch (e) {\n        // Ignore feature usage callback errors\n      }\n    }\n\n    // In browser environments, queue up feature usage to be tracked in batches\n    if (!isBrowser || !window.fetch) return;\n  }\n\n  private _getFeatureResult<T>(\n    key: string,\n    value: T,\n    source: FeatureResultSource,\n    ruleId?: string,\n    experiment?: Experiment<T>,\n    result?: Result<T>\n  ): FeatureResult<T> {\n    const ret: FeatureResult = {\n      value,\n      on: !!value,\n      off: !value,\n      source,\n      ruleId: ruleId || \"\",\n    };\n    if (experiment) ret.experiment = experiment;\n    if (result) ret.experimentResult = result;\n\n    // Track the usage of this feature in real-time\n    this._trackFeatureUsage(key, ret);\n\n    return ret;\n  }\n\n  public isOn<K extends string & keyof AppFeatures = string>(key: K): boolean {\n    return this.evalFeature(key).on;\n  }\n\n  public isOff<K extends string & keyof AppFeatures = string>(key: K): boolean {\n    return this.evalFeature(key).off;\n  }\n\n  public getFeatureValue<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(key: K, defaultValue: V): WidenPrimitives<V> {\n    const value = this.evalFeature<WidenPrimitives<V>, K>(key).value;\n    return value === null ? (defaultValue as WidenPrimitives<V>) : value;\n  }\n\n  /**\n   * @deprecated Use {@link evalFeature}\n   * @param id\n   */\n  // eslint-disable-next-line\n  public feature<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(id: K): FeatureResult<V | null> {\n    return this.evalFeature(id);\n  }\n\n  public evalFeature<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(id: K): FeatureResult<V | null> {\n    // Global override\n    if (this._forcedFeatureValues.has(id)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Global override\", {\n          id,\n          value: this._forcedFeatureValues.get(id),\n        });\n      return this._getFeatureResult(\n        id,\n        this._forcedFeatureValues.get(id),\n        \"override\"\n      );\n    }\n\n    // Unknown feature id\n    if (!this._ctx.features || !this._ctx.features[id]) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Unknown feature\", { id });\n      return this._getFeatureResult(id, null, \"unknownFeature\");\n    }\n\n    // Get the feature\n    const feature: FeatureDefinition<V> = this._ctx.features[id];\n\n    // Loop through the rules\n    if (feature.rules) {\n      for (const rule of feature.rules) {\n        // If it's a conditional rule, skip if the condition doesn't pass\n        if (rule.condition && !this._conditionPasses(rule.condition)) {\n          process.env.NODE_ENV !== \"production\" &&\n            this.log(\"Skip rule because of condition\", {\n              id,\n              rule,\n            });\n          continue;\n        }\n        // If there are filters for who is included (e.g. namespaces)\n        if (rule.filters && this._isFilteredOut(rule.filters)) {\n          process.env.NODE_ENV !== \"production\" &&\n            this.log(\"Skip rule because of filters\", {\n              id,\n              rule,\n            });\n          continue;\n        }\n\n        // Feature value is being forced\n        if (\"force\" in rule) {\n          // If this is a percentage rollout, skip if not included\n          if (\n            !this._isIncludedInRollout(\n              rule.seed || id,\n              rule.hashAttribute,\n              rule.range,\n              rule.coverage,\n              rule.hashVersion\n            )\n          ) {\n            process.env.NODE_ENV !== \"production\" &&\n              this.log(\"Skip rule because user not included in rollout\", {\n                id,\n                rule,\n              });\n            continue;\n          }\n\n          process.env.NODE_ENV !== \"production\" &&\n            this.log(\"Force value from rule\", {\n              id,\n              rule,\n            });\n\n          // If this was a remotely evaluated experiment, fire the tracking callbacks\n          if (rule.tracks) {\n            rule.tracks.forEach((t) => {\n              this._track(t.experiment, t.result);\n            });\n          }\n\n          return this._getFeatureResult(id, rule.force as V, \"force\", rule.id);\n        }\n        if (!rule.variations) {\n          process.env.NODE_ENV !== \"production\" &&\n            this.log(\"Skip invalid rule\", {\n              id,\n              rule,\n            });\n\n          continue;\n        }\n        // For experiment rules, run an experiment\n        const exp: Experiment<V> = {\n          variations: rule.variations as [V, V, ...V[]],\n          key: rule.key || id,\n        };\n        if (\"coverage\" in rule) exp.coverage = rule.coverage;\n        if (rule.weights) exp.weights = rule.weights;\n        if (rule.hashAttribute) exp.hashAttribute = rule.hashAttribute;\n        if (rule.namespace) exp.namespace = rule.namespace;\n        if (rule.meta) exp.meta = rule.meta;\n        if (rule.ranges) exp.ranges = rule.ranges;\n        if (rule.name) exp.name = rule.name;\n        if (rule.phase) exp.phase = rule.phase;\n        if (rule.seed) exp.seed = rule.seed;\n        if (rule.hashVersion) exp.hashVersion = rule.hashVersion;\n        if (rule.filters) exp.filters = rule.filters;\n\n        // Only return a value if the user is part of the experiment\n        const res = this._run(exp, id);\n        this._fireSubscriptions(exp, res);\n        if (res.inExperiment && !res.passthrough) {\n          return this._getFeatureResult(\n            id,\n            res.value,\n            \"experiment\",\n            rule.id,\n            exp,\n            res\n          );\n        }\n      }\n    }\n\n    process.env.NODE_ENV !== \"production\" &&\n      this.log(\"Use default value\", {\n        id,\n        value: feature.defaultValue,\n      });\n\n    // Fall back to using the default value\n    return this._getFeatureResult(\n      id,\n      feature.defaultValue === undefined ? null : feature.defaultValue,\n      \"defaultValue\"\n    );\n  }\n\n  private _isIncludedInRollout(\n    seed: string,\n    hashAttribute: string | undefined,\n    range: VariationRange | undefined,\n    coverage: number | undefined,\n    hashVersion: number | undefined\n  ): boolean {\n    if (!range && coverage === undefined) return true;\n\n    const { hashValue } = this._getHashAttribute(hashAttribute);\n    if (!hashValue) {\n      return false;\n    }\n\n    const n = hash(seed, hashValue, hashVersion || 1);\n    if (n === null) return false;\n\n    return range\n      ? inRange(n, range)\n      : coverage !== undefined\n      ? n <= coverage\n      : true;\n  }\n\n  private _conditionPasses(condition: ConditionInterface): boolean {\n    return evalCondition(this.getAttributes(), condition);\n  }\n\n  private _isFilteredOut(filters: Filter[]): boolean {\n    return filters.some((filter) => {\n      const { hashValue } = this._getHashAttribute(filter.attribute);\n      if (!hashValue) return true;\n      const n = hash(filter.seed, hashValue, filter.hashVersion || 2);\n      if (n === null) return true;\n      return !filter.ranges.some((r) => inRange(n, r));\n    });\n  }\n\n  private _run<T>(\n    experiment: Experiment<T>,\n    featureId: string | null\n  ): Result<T> {\n    const key = experiment.key;\n    const numVariations = experiment.variations.length;\n\n    // 1. If experiment has less than 2 variations, return immediately\n    if (numVariations < 2) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Invalid experiment\", { id: key });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 2. If the context is disabled, return immediately\n    if (this._ctx.enabled === false) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Context disabled\", { id: key });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 2.5. Merge in experiment overrides from the context\n    experiment = this._mergeOverrides(experiment);\n\n    // 3. If a variation is forced from a querystring, return the forced variation\n    const qsOverride = getQueryStringOverride(\n      key,\n      this._getContextUrl(),\n      numVariations\n    );\n    if (qsOverride !== null) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Force via querystring\", {\n          id: key,\n          variation: qsOverride,\n        });\n      return this._getResult(experiment, qsOverride, false, featureId);\n    }\n\n    // 4. If a variation is forced in the context, return the forced variation\n    if (this._ctx.forcedVariations && key in this._ctx.forcedVariations) {\n      const variation = this._ctx.forcedVariations[key];\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Force via dev tools\", {\n          id: key,\n          variation,\n        });\n      return this._getResult(experiment, variation, false, featureId);\n    }\n\n    // 5. Exclude if a draft experiment or not active\n    if (experiment.status === \"draft\" || experiment.active === false) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because inactive\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 6. Get the hash attribute and return if empty\n    const { hashValue } = this._getHashAttribute(experiment.hashAttribute);\n    if (!hashValue) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because missing hashAttribute\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 7. Exclude if user is filtered out (used to be called \"namespace\")\n    if (experiment.filters) {\n      if (this._isFilteredOut(experiment.filters)) {\n        process.env.NODE_ENV !== \"production\" &&\n          this.log(\"Skip because of filters\", {\n            id: key,\n          });\n        return this._getResult(experiment, -1, false, featureId);\n      }\n    } else if (\n      experiment.namespace &&\n      !inNamespace(hashValue, experiment.namespace)\n    ) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of namespace\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 7.5. Exclude if experiment.include returns false or throws\n    if (experiment.include && !isIncluded(experiment.include)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of include function\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 8. Exclude if condition is false\n    if (experiment.condition && !this._conditionPasses(experiment.condition)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of condition\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 8.1. Exclude if user is not in a required group\n    if (\n      experiment.groups &&\n      !this._hasGroupOverlap(experiment.groups as string[])\n    ) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of groups\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 8.2. Old style URL targeting\n    if (experiment.url && !this._urlIsValid(experiment.url as RegExp)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of url\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 8.3. New, more powerful URL targeting\n    if (\n      experiment.urlPatterns &&\n      !isURLTargeted(this._getContextUrl(), experiment.urlPatterns)\n    ) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of url targeting\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 9. Get bucket ranges and choose variation\n    const n = hash(\n      experiment.seed || key,\n      hashValue,\n      experiment.hashVersion || 1\n    );\n    if (n === null) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of invalid hash version\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    const ranges =\n      experiment.ranges ||\n      getBucketRanges(\n        numVariations,\n        experiment.coverage === undefined ? 1 : experiment.coverage,\n        experiment.weights\n      );\n\n    const assigned = chooseVariation(n, ranges);\n\n    // 10. Return if not in experiment\n    if (assigned < 0) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of coverage\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 11. Experiment has a forced variation\n    if (\"force\" in experiment) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Force variation\", {\n          id: key,\n          variation: experiment.force,\n        });\n      return this._getResult(\n        experiment,\n        experiment.force === undefined ? -1 : experiment.force,\n        false,\n        featureId\n      );\n    }\n\n    // 12. Exclude if in QA mode\n    if (this._ctx.qaMode) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because QA mode\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 12.5. Exclude if experiment is stopped\n    if (experiment.status === \"stopped\") {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because stopped\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 13. Build the result object\n    const result = this._getResult(experiment, assigned, true, featureId, n);\n\n    // 14. Fire the tracking callback\n    this._track(experiment, result);\n\n    // 15. Return the result\n    process.env.NODE_ENV !== \"production\" &&\n      this.log(\"In experiment\", {\n        id: key,\n        variation: result.variationId,\n      });\n    return result;\n  }\n\n  log(msg: string, ctx: Record<string, unknown>) {\n    if (!this.debug) return;\n    if (this._ctx.log) this._ctx.log(msg, ctx);\n    else console.log(msg, ctx);\n  }\n\n  private _track<T>(experiment: Experiment<T>, result: Result<T>) {\n    if (!this._ctx.trackingCallback) return;\n\n    const key = experiment.key;\n\n    // Make sure a tracking callback is only fired once per unique experiment\n    const k =\n      result.hashAttribute + result.hashValue + key + result.variationId;\n    if (this._trackedExperiments.has(k)) return;\n    this._trackedExperiments.add(k);\n\n    try {\n      this._ctx.trackingCallback(experiment, result);\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  private _mergeOverrides<T>(experiment: Experiment<T>): Experiment<T> {\n    const key = experiment.key;\n    const o = this._ctx.overrides;\n    if (o && o[key]) {\n      experiment = Object.assign({}, experiment, o[key]);\n      if (typeof experiment.url === \"string\") {\n        experiment.url = getUrlRegExp(\n          // eslint-disable-next-line\n          experiment.url as any\n        );\n      }\n    }\n\n    return experiment;\n  }\n\n  private _getHashAttribute(attr?: string) {\n    const hashAttribute = attr || \"id\";\n\n    let hashValue = \"\";\n    if (this._attributeOverrides[hashAttribute]) {\n      hashValue = this._attributeOverrides[hashAttribute];\n    } else if (this._ctx.attributes) {\n      hashValue = this._ctx.attributes[hashAttribute] || \"\";\n    } else if (this._ctx.user) {\n      hashValue = this._ctx.user[hashAttribute] || \"\";\n    }\n\n    return { hashAttribute, hashValue };\n  }\n\n  private _getResult<T>(\n    experiment: Experiment<T>,\n    variationIndex: number,\n    hashUsed: boolean,\n    featureId: string | null,\n    bucket?: number\n  ): Result<T> {\n    let inExperiment = true;\n    // If assigned variation is not valid, use the baseline and mark the user as not in the experiment\n    if (variationIndex < 0 || variationIndex >= experiment.variations.length) {\n      variationIndex = 0;\n      inExperiment = false;\n    }\n\n    const { hashAttribute, hashValue } = this._getHashAttribute(\n      experiment.hashAttribute\n    );\n\n    const meta: Partial<VariationMeta> = experiment.meta\n      ? experiment.meta[variationIndex]\n      : {};\n\n    const res: Result<T> = {\n      key: meta.key || \"\" + variationIndex,\n      featureId,\n      inExperiment,\n      hashUsed,\n      variationId: variationIndex,\n      value: experiment.variations[variationIndex],\n      hashAttribute,\n      hashValue,\n    };\n\n    if (meta.name) res.name = meta.name;\n    if (bucket !== undefined) res.bucket = bucket;\n    if (meta.passthrough) res.passthrough = meta.passthrough;\n\n    return res;\n  }\n\n  private _getContextUrl() {\n    return this._ctx.url || (isBrowser ? window.location.href : \"\");\n  }\n\n  private _urlIsValid(urlRegex: RegExp): boolean {\n    const url = this._getContextUrl();\n    if (!url) return false;\n\n    const pathOnly = url.replace(/^https?:\\/\\//, \"\").replace(/^[^/]*\\//, \"/\");\n\n    if (urlRegex.test(url)) return true;\n    if (urlRegex.test(pathOnly)) return true;\n    return false;\n  }\n\n  private _hasGroupOverlap(expGroups: string[]): boolean {\n    const groups = this._ctx.groups || {};\n    for (let i = 0; i < expGroups.length; i++) {\n      if (groups[expGroups[i]]) return true;\n    }\n    return false;\n  }\n}\n"],"names":["hashFnv32a","str","hval","l","length","i","charCodeAt","hash","seed","value","version","getEqualWeights","n","Array","fill","inRange","range","inNamespace","hashValue","namespace","chooseVariation","ranges","getUrlRegExp","regexString","escaped","replace","RegExp","e","console","error","undefined","isURLTargeted","url","targets","hasIncludeRules","isIncluded","match","_evalURLTarget","type","pattern","include","_evalSimpleUrlPart","actual","isPath","regex","test","_evalSimpleUrlTarget","expected","URL","comps","host","pathname","push","searchParams","forEach","v","k","get","some","data","parsed","href","substring","origin","getBucketRanges","numVariations","coverage","weights","equal","totalWeight","reduce","w","sum","cumulative","map","start","getQueryStringOverride","id","search","split","kv","filter","parseInt","paddedVersionString","input","parts","padStart","join","_regexCache","evalCondition","obj","condition","evalOr","evalAnd","Object","entries","evalConditionValue","getPath","path","current","getRegex","isArray","isOperatorObject","JSON","stringify","op","evalOperatorCondition","keys","getType","t","includes","elemMatch","check","isIn","el","operator","passed","j","conditions","isBrowser","window","document","GrowthBook","constructor","context","_ctx","_renderer","_trackedExperiments","Set","_trackedFeatures","debug","_subscriptions","ready","_assigned","Map","_forcedFeatureValues","_attributeOverrides","_activeAutoExperiments","features","enableDevMode","_growthbook","dispatchEvent","Event","experiments","_render","setFeatures","setAttributes","attributes","setAttributeOverrides","overrides","setForcedVariations","vars","forcedVariations","setForcedFeatures","setURL","getAttributes","getFeatures","getExperiments","subscribe","cb","add","delete","getAllResults","destroy","clear","exp","undo","setRenderer","renderer","forceVariation","key","variation","run","experiment","result","_run","_fireSubscriptions","prev","inExperiment","variationId","set","_trackFeatureUsage","res","source","stringifiedValue","onFeatureUsage","fetch","_getFeatureResult","ruleId","ret","on","off","experimentResult","isOn","evalFeature","isOff","getFeatureValue","defaultValue","feature","has","rules","rule","_conditionPasses","filters","_isFilteredOut","_isIncludedInRollout","hashAttribute","hashVersion","tracks","_track","force","variations","meta","name","phase","passthrough","_getHashAttribute","attribute","r","featureId","_getResult","enabled","_mergeOverrides","qsOverride","_getContextUrl","status","active","groups","_hasGroupOverlap","_urlIsValid","urlPatterns","assigned","qaMode","log","msg","ctx","trackingCallback","o","assign","attr","user","variationIndex","hashUsed","bucket","location","urlRegex","pathOnly","expGroups"],"mappings":"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"}