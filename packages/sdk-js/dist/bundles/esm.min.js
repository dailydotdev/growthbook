function t(t){let r=2166136261;const e=t.length;for(let n=0;n<e;n++)r^=t.charCodeAt(n),r+=(r<<1)+(r<<4)+(r<<7)+(r<<8)+(r<<24);return r>>>0}function r(r,e,n){return 2===n?t(t(r+e)+"")%1e4/1e4:1===n?t(e+r)%1e3/1e3:null}function e(t,r){return t>=r[0]&&t<r[1]}function n(t){try{const r=t.replace(/([^\\])\//g,"$1\\/");return new RegExp(r)}catch(t){return void console.error(t)}}function i(t,r){if(!r.length)return!1;let e=!1,n=!1;for(let i=0;i<r.length;i++){const u=s(t,r[i].type,r[i].pattern);if(!1===r[i].include){if(u)return!1}else e=!0,u&&(n=!0)}return n||!e}function s(t,r,e){try{const i=new URL(t,"https://_");if("regex"===r){const t=n(e);return!!t&&(t.test(i.href)||t.test(i.href.substring(i.origin.length)))}return"simple"===r&&function(t,r){try{const e=new URL(r.replace(/^([^:/?]*)\./i,"https://$1.").replace(/\*/g,"_____"),"https://_____"),n=[[t.host,e.host,!1],[t.pathname,e.pathname,!0]];return e.hash&&n.push([t.hash,e.hash,!1]),e.searchParams.forEach(((r,e)=>{n.push([t.searchParams.get(e)||"",r,!1])})),!n.some((t=>!function(t,r,e){try{let n=r.replace(/[*.+?^${}()|[\]\\]/g,"\\$&").replace(/_____/g,".*");return e&&(n="\\/?"+n.replace(/(^\/|\/$)/g,"")+"\\/?"),new RegExp("^"+n+"$","i").test(t)}catch(t){return!1}}(t[0],t[1],t[2])))}catch(t){return!1}}(i,e)}catch(t){return!1}}function u(t){const r=t.replace(/(^v|\+.*$)/g,"").split(/[-.]/);return 3===r.length&&r.push("~"),r.map((t=>t.match(/^[0-9]+$/)?t.padStart(5," "):t)).join("-")}const o={};function h(t,r){if("$or"in r)return $(t,r.$or);if("$nor"in r)return!$(t,r.$nor);if("$and"in r)return function(t,r){for(let e=0;e<r.length;e++)if(!h(t,r[e]))return!1;return!0}(t,r.$and);if("$not"in r)return!h(t,r.$not);for(const[e,n]of Object.entries(r))if(!f(n,c(t,e)))return!1;return!0}function c(t,r){const e=r.split(".");let n=t;for(let t=0;t<e.length;t++){if(!n||"object"!=typeof n||!(e[t]in n))return null;n=n[e[t]]}return n}function f(t,r){if("string"==typeof t)return r+""===t;if("number"==typeof t)return 1*r===t;if("boolean"==typeof t)return!!r===t;if(null===t)return null===r;if(Array.isArray(t)||!l(t))return JSON.stringify(r)===JSON.stringify(t);for(const e in t)if(!d(e,r,t[e]))return!1;return!0}function l(t){const r=Object.keys(t);return r.length>0&&r.filter((t=>"$"===t[0])).length===r.length}function a(t,r){return Array.isArray(t)?t.some((t=>r.includes(t))):r.includes(t)}function d(t,r,e){switch(t){case"$veq":return u(r)===u(e);case"$vne":return u(r)!==u(e);case"$vgt":return u(r)>u(e);case"$vgte":return u(r)>=u(e);case"$vlt":return u(r)<u(e);case"$vlte":return u(r)<=u(e);case"$eq":return r===e;case"$ne":return r!==e;case"$lt":return r<e;case"$lte":return r<=e;case"$gt":return r>e;case"$gte":return r>=e;case"$exists":return e?null!==r:null===r;case"$in":return!!Array.isArray(e)&&a(r,e);case"$nin":return!!Array.isArray(e)&&!a(r,e);case"$not":return!f(e,r);case"$size":return!!Array.isArray(r)&&f(e,r.length);case"$elemMatch":return function(t,r){if(!Array.isArray(t))return!1;const e=l(r)?t=>f(r,t):t=>h(t,r);for(let r=0;r<t.length;r++)if(t[r]&&e(t[r]))return!0;return!1}(r,e);case"$all":if(!Array.isArray(r))return!1;for(let t=0;t<e.length;t++){let n=!1;for(let i=0;i<r.length;i++)if(f(e[t],r[i])){n=!0;break}if(!n)return!1}return!0;case"$regex":try{return(n=e,o[n]||(o[n]=new RegExp(n.replace(/([^\\])\//g,"$1\\/"))),o[n]).test(r)}catch(t){return!1}case"$type":return function(t){if(null===t)return"null";if(Array.isArray(t))return"array";const r=typeof t;return["string","number","boolean","object","undefined"].includes(r)?r:"unknown"}(r)===e;default:return console.error("Unknown operator: "+t),!1}var n}function $(t,r){if(!r.length)return!0;for(let e=0;e<r.length;e++)if(h(t,r[e]))return!0;return!1}const g="undefined"!=typeof window&&"undefined"!=typeof document;class p{constructor(t){this.t=this.context=t=t||{},this.i=null,this.u=new Set,this.o={},this.debug=!1,this.h=new Set,this.ready=!1,this.l=new Map,this.$=new Map,this.g={},this.p=new Map,t.features&&(this.ready=!0),g&&t.enableDevMode&&(window._growthbook=this,document.dispatchEvent(new Event("gbloaded"))),t.experiments&&(this.ready=!0)}_(){this.i&&this.i()}setFeatures(t){this.t.features=t,this.ready=!0,this._()}setAttributes(t){this.t.attributes=t,this._()}setAttributeOverrides(t){this.g=t,this._()}setForcedVariations(t){this.t.forcedVariations=t||{},this._()}setForcedFeatures(t){this.$=t,this._()}setURL(t){this.t.url=t}getAttributes(){return{...this.t.attributes,...this.g}}getFeatures(){return this.t.features||{}}getExperiments(){return this.t.experiments||[]}subscribe(t){return this.h.add(t),()=>{this.h.delete(t)}}getAllResults(){return new Map(this.l)}destroy(){this.h.clear(),this.l.clear(),this.u.clear(),this.o={},g&&window._growthbook===this&&delete window._growthbook,this.p.forEach((t=>{t.undo()})),this.p.clear()}setRenderer(t){this.i=t}forceVariation(t,r){this.t.forcedVariations=this.t.forcedVariations||{},this.t.forcedVariations[t]=r,this._()}run(t){const r=this.v(t,null);return this.A(t,r),r}A(t,r){const e=t.key,n=this.l.get(e);n&&n.result.inExperiment===r.inExperiment&&n.result.variationId===r.variationId||(this.l.set(e,{experiment:t,result:r}),this.h.forEach((e=>{try{e(t,r)}catch(t){console.error(t)}})))}O(t,r){if("override"===r.source)return;const e=JSON.stringify(r.value);if(this.o[t]!==e){if(this.o[t]=e,this.t.onFeatureUsage)try{this.t.onFeatureUsage(t,r)}catch(t){}g&&window}}m(t,r,e,n,i,s){const u={value:r,on:!!r,off:!r,source:e,ruleId:n||""};return i&&(u.experiment=i),s&&(u.experimentResult=s),this.O(t,u),u}isOn(t){return this.evalFeature(t).on}isOff(t){return this.evalFeature(t).off}getFeatureValue(t,r){const e=this.evalFeature(t).value;return null===e?r:e}feature(t){return this.evalFeature(t)}evalFeature(t){if(this.$.has(t))return this.m(t,this.$.get(t),"override");if(!this.t.features||!this.t.features[t])return this.m(t,null,"unknownFeature");const r=this.t.features[t];if(r.rules)for(const e of r.rules){if(e.condition&&!this.F(e.condition))continue;if(e.filters&&this.R(e.filters))continue;if("force"in e){if(!this.V(e.seed||t,e.hashAttribute,e.range,e.coverage,e.hashVersion))continue;return e.tracks&&e.tracks.forEach((t=>{this.k(t.experiment,t.result)})),this.m(t,e.force,"force",e.id)}if(!e.variations)continue;const r={variations:e.variations,key:e.key||t};"coverage"in e&&(r.coverage=e.coverage),e.weights&&(r.weights=e.weights),e.hashAttribute&&(r.hashAttribute=e.hashAttribute),e.namespace&&(r.namespace=e.namespace),e.meta&&(r.meta=e.meta),e.ranges&&(r.ranges=e.ranges),e.name&&(r.name=e.name),e.phase&&(r.phase=e.phase),e.seed&&(r.seed=e.seed),e.hashVersion&&(r.hashVersion=e.hashVersion),e.filters&&(r.filters=e.filters);const n=this.v(r,t);if(this.A(r,n),n.inExperiment&&!n.passthrough)return this.m(t,n.value,"experiment",e.id,r,n)}return this.m(t,void 0===r.defaultValue?null:r.defaultValue,"defaultValue")}V(t,n,i,s,u){if(!i&&void 0===s)return!0;const{hashValue:o}=this.I(n);if(!o)return!1;const h=r(t,o,u||1);return null!==h&&(i?e(h,i):void 0===s||h<=s)}F(t){return h(this.getAttributes(),t)}R(t){return t.some((t=>{const{hashValue:n}=this.I(t.attribute);if(!n)return!0;const i=r(t.seed,n,t.hashVersion||2);return null===i||!t.ranges.some((t=>e(i,t)))}))}v(t,n){const s=t.key,u=t.variations.length;if(u<2)return this.U(t,-1,!1,n);if(!1===this.t.enabled)return this.U(t,-1,!1,n);t=this.S(t);const o=function(t,r,e){if(!r)return null;const n=r.split("?")[1];if(!n)return null;const i=n.replace(/#.*/,"").split("&").map((t=>t.split("=",2))).filter((r=>{let[e]=r;return e===t})).map((t=>{let[,r]=t;return parseInt(r)}));return i.length>0&&i[0]>=0&&i[0]<e?i[0]:null}(s,this.j(),u);if(null!==o)return this.U(t,o,!1,n);if(this.t.forcedVariations&&s in this.t.forcedVariations)return this.U(t,this.t.forcedVariations[s],!1,n);if("draft"===t.status||!1===t.active)return this.U(t,-1,!1,n);const{hashValue:h}=this.I(t.hashAttribute);if(!h)return this.U(t,-1,!1,n);if(t.filters){if(this.R(t.filters))return this.U(t,-1,!1,n)}else if(t.namespace&&!function(t,e){const n=r("__"+e[0],t,1);return null!==n&&n>=e[1]&&n<e[2]}(h,t.namespace))return this.U(t,-1,!1,n);if(t.include&&!function(t){try{return t()}catch(t){return console.error(t),!1}}(t.include))return this.U(t,-1,!1,n);if(t.condition&&!this.F(t.condition))return this.U(t,-1,!1,n);if(t.groups&&!this.M(t.groups))return this.U(t,-1,!1,n);if(t.url&&!this.J(t.url))return this.U(t,-1,!1,n);if(t.urlPatterns&&!i(this.j(),t.urlPatterns))return this.U(t,-1,!1,n);const c=r(t.seed||s,h,t.hashVersion||1);if(null===c)return this.U(t,-1,!1,n);const f=function(t,r){for(let n=0;n<r.length;n++)if(e(t,r[n]))return n;return-1}(c,t.ranges||function(t,r,e){(r=void 0===r?1:r)<0?r=0:r>1&&(r=1);const n=(i=t)<=0?[]:new Array(i).fill(1/i);var i;(e=e||n).length!==t&&(e=n);const s=e.reduce(((t,r)=>r+t),0);(s<.99||s>1.01)&&(e=n);let u=0;return e.map((t=>{const e=u;return u+=t,[e,e+r*t]}))}(u,void 0===t.coverage?1:t.coverage,t.weights));if(f<0)return this.U(t,-1,!1,n);if("force"in t)return this.U(t,void 0===t.force?-1:t.force,!1,n);if(this.t.qaMode)return this.U(t,-1,!1,n);if("stopped"===t.status)return this.U(t,-1,!1,n);const l=this.U(t,f,!0,n,c);return this.k(t,l),l}log(t,r){this.debug&&(this.t.log?this.t.log(t,r):console.log(t,r))}k(t,r){if(!this.t.trackingCallback)return;const e=r.hashAttribute+r.hashValue+t.key+r.variationId;if(!this.u.has(e)){this.u.add(e);try{this.t.trackingCallback(t,r)}catch(t){console.error(t)}}}S(t){const r=t.key,e=this.t.overrides;return e&&e[r]&&"string"==typeof(t=Object.assign({},t,e[r])).url&&(t.url=n(t.url)),t}I(t){const r=t||"id";let e="";return this.g[r]?e=this.g[r]:this.t.attributes?e=this.t.attributes[r]||"":this.t.user&&(e=this.t.user[r]||""),{hashAttribute:r,hashValue:e}}U(t,r,e,n,i){let s=!0;(r<0||r>=t.variations.length)&&(r=0,s=!1);const{hashAttribute:u,hashValue:o}=this.I(t.hashAttribute),h=t.meta?t.meta[r]:{},c={key:h.key||""+r,featureId:n,inExperiment:s,hashUsed:e,variationId:r,value:t.variations[r],hashAttribute:u,hashValue:o};return h.name&&(c.name=h.name),void 0!==i&&(c.bucket=i),h.passthrough&&(c.passthrough=h.passthrough),c}j(){return this.t.url||(g?window.location.href:"")}J(t){const r=this.j();if(!r)return!1;const e=r.replace(/^https?:\/\//,"").replace(/^[^/]*\//,"/");return!!t.test(r)||!!t.test(e)}M(t){const r=this.t.groups||{};for(let e=0;e<t.length;e++)if(r[t[e]])return!0;return!1}}export{p as GrowthBook,i as isURLTargeted};
//# sourceMappingURL=esm.min.js.map
